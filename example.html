<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport' content='width=device-width, initial-scale=1">
    <title>Chrome Serial Bridge Example</title>

    <!--
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    -->

    <script>
        var serialBridge = null;

        async function checkSerialBridgePortIsConnect() {
            try {
                //const port = await navigator.serial.requestPort();
                //console.log(port)
                // Continue connecting to the device attached to port.
                const ports = await navigator.serial.getPorts();
                console.log(ports)
            } catch (e) {
                console.error(e)
                // The prompt has been dismissed without selecting a device.
            }

            serialBridge.isPortConnect(
                function(response) {
                    console.debug("TODO: isPortConnect()", response)
                }
            );
        }

        function afterLoaded() {
            SerialBridgeExtensionInstalled = false
            ChromeSerialBridgeFrame = document.getElementById('ChromeSerialBridgeFrame')
            if ( ChromeSerialBridgeFrame === null) {
                alert("Serial Bridge interface extension is missing. Please install.");
            }
            else {
                ChromeSerialBridgeFrame.contentWindow.isSerialBridgeExtensionInstalled(
                    function (installed) {
                        if (installed.result === 'ERR') {
                            alert("No communication with the Serial Bridge interface extension.");
                        }
                        else {
                            serialBridge = new ChromeSerialBridgeFrame.contentWindow.SerialBridge;
                            document.getElementById("checkserialport").disabled = false;
                        }
                    }
                );
            }
        }
        window.addEventListener("load", afterLoaded, false);
    </script>
</head>

<body>
    <br>
    <button id="checkserialport" onclick="checkSerialBridgePortIsConnect()" disabled>Check Serial Bridge port is connected</button>
    <br>
    <button id="connect">Connect</button>

    <script>
        connectButton.addEventListener('click', async () => {
        try {
            const port = await navigator.serial.requestPort();
            console.log(port)
        } catch (e) {
            console.error(e)
        }
        });
    </script>

</body>

</html>